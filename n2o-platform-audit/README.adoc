= –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è


== –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
–°—Ç–∞—Ä—Ç–µ—Ä –¥–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–µ—Å—Ç–∏ –∞—É–¥–∏—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã –≤ –±–¥ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –∫—Ç–æ, –∫–æ–≥–¥–∞ –∏ –∏–∑ –∫–∞–∫–æ–π —Å–∏—Å—Ç–µ–º—ã —Å–æ–∑–¥–∞–ª –∏ –ø—Ä–æ–∏–∑–≤–µ–ª –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ –¥–µ–ª—å—Ç—É –∏–∑–º–µ–Ω–µ–Ω–∏–π.

== –û–±—â–∞—è —Å—Ö–µ–º–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
–ê—É–¥–∏—Ç –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ —Ç—Ä–∏–≥–≥–µ—Ä–∞—Ö. –ö –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü–µ –≤ –±–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ —ç—Ç–∞–ø–µ –¥–µ–ø–ª–æ—è –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –¥–≤–∞ —Ç—Ä–∏–≥–≥–µ—Ä–∞(audit_trigger –∏ audit_trigger_full)
–∏ —Ç–∞–±–ª–∏—Ü–∞ –∞—É–¥–∏—Ç–∞, –∫–æ—Ç–æ—Ä–∞—è –∏–º–µ–µ—Ç —Ñ–æ—Ä–º–∞—Ç –Ω–∞–∑–≤–∞–Ω–∏—è audit.<—Å—Ö–µ–º–∞ –∞—É–¥–∏—Ä—É–µ–º–æ–π —Ç–∞–±–ª–∏—Ü—ã>$<–∞—É–¥–∏—Ä—É–µ–º–∞—è —Ç–∞–±–ª–∏—Ü–∞>.
–¢–∞–∫–∂–µ –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Ç–∞–±–ª–∏—Ü—É –¥–æ–±–∞–≤—è—Ç—Å—è –∫–æ–ª–æ–Ω–∫–∏ –∞—É–¥–∏—Ç–∞ (aud_who, aud_when, aud_source, aud_who_create, aud_when_create, aud_source_create).
–ù–∞–ø—Ä–∏–º–µ—Ä –µ—Å—Ç—å —Ç–∞–±–ª–∏—Ü–∞ public.foo, —Ç–æ —Ç–∞–±–ª–∏—Ü–∞ –∞—É–¥–∏—Ç–∞ –±—É–¥–µ—Ç –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è audit.public$foo –∏ –≤ —Ç–∞–±–ª–∏—Ü—É public.foo –¥–æ–±–∞–≤—è—Ç—Å—è 6 –∫–æ–ª–æ–Ω–æ–∫.

== –û–ø–∏—Å–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –∞—É–¥–∏—Ç–∞
[frame=ends]
|===
|*–ö–æ–ª–æ–Ω–∫–∞* |*–¢–∏–ø* |*–û–ø–∏—Å–∞–Ω–∏–µ*

|aud_rec
|bigint
|–ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á

|<–∫–æ–ª–æ–Ω–∫–∞ –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á –∞—É–¥–∏—Ä—É–µ–º–æ–π —Ç–∞–±–ª–∏—Ü—ã>
|<—Ç–∏–ø –∫–æ–ª–æ–Ω–∫–∏ –∏–∑ –∞—É–¥–∏—Ä—É–µ–º–æ–π —Ç–∞–±–ª–∏—Ü—ã>
|–•—Ä–∞–Ω–∏—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏ –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞ –∏–∑ –∞—É–¥–∏—Ä—É–µ–º–æ–π —Ç–∞–±–ª–∏—Ü—ã. –ï—Å–ª–∏ –≤ –∞—É–¥–∏—Ä—É–µ–º–æ–π —Ç–∞–±–ª–∏—Ü—ã –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á —Å–æ—Å—Ç–∞–≤–Ω–æ–π, —Ç–æ –±—É–¥–µ—Ç —Å—Ç–æ–ª—å–∫–æ –∂–µ –∫–æ–ª–æ–Ω–æ–∫

|type
|text
|–¢–∏–ø –¥–µ–π—Å—Ç–≤–∏—è –Ω–∞–¥ —Å—Ç—Ä–æ–∫–æ–π —Ç–∞–±–ª–∏—Ü—ã I - –≤—Å—Ç–∞–≤–∫–∞, U - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, D - —É–¥–∞–ª–µ–Ω–∏–µ

|delta
|jsonb
|–†–∞–∑–Ω–∏—Ü–∞ —Å—Ç—Ä–æ–∫–∏ –¥–æ –∏ –ø–æ—Å–ª–µ –¥–µ–π—Å—Ç–≤–∏—è –Ω–∞–¥ —Å—Ç—Ä–æ–∫–æ–π —Ç–∞–±–ª–∏—Ü—ã

|aud_when
|timestamp
|–ö–æ–≥–¥–∞ –±—ã–ª–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–∞ —Å—Ç—Ä–æ–∫–æ–π —Ç–∞–±–ª–∏—Ü—ã, –ø–æ —Ñ–∞–∫—Ç—É –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

|aud_who
|varchar
|–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω–∏–ª –¥–µ–π—Å—Ç–≤–∏–µ –Ω–∞–¥ —Å—Ç—Ä–æ–∫–æ–π —Ç–∞–±–ª–∏—Ü—ã. –ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Ç–æ –∑–∞–ø–∏—à–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–¥

|aud_source
|varchar
|–°–∏—Å—Ç–µ–º–∞-–∏—Å—Ç–æ—á–Ω–∏–∫, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–ø–æ–ª–Ω–∏–ª–∞ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–∞ —Å—Ç—Ä–æ–∫–æ–π —Ç–∞–±–ª–∏—Ü—ã. –ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ, —Ç–æ –∑–∞–ø–∏—à–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ DB

|data
|jsonb
|–•—Ä–∞–Ω–∏—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –ø–æ—Å–ª–µ –¥–µ–π—Å—Ç–≤–∏—è –Ω–∞–¥ —Ç–∞–±–ª–∏—Ü–µ–π, –∏–ª–∏ –¥–æ –¥–µ–π—Å—Ç–≤–∏—è –≤ —Å–ª—É—á–∞–µ —É–¥–∞–ª–µ–Ω–∏—è. –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏ null —Ç–æ –æ–Ω–∞ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è

|dump
|jsonb
|–ù–∞—á–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö –∞—Ç—Ä–∏–±—É—Ç–æ–≤
|===

== –û–ø–∏—Å–∞–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫ –∞—É–¥–∏—Ç–∞ –≤ –∏—Å—Ö–æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ
|===
|*–ö–æ–ª–æ–Ω–∫–∞* |*–¢–∏–ø* |*–û–ø–∏—Å–∞–Ω–∏–µ*
|aud_when
|timestamp
|–í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏, –ø–æ —Ñ–∞–∫—Ç—É –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

|aud_who
|varchar
|–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∫–æ—Ç–æ—Ä—ã–π –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ –º–µ–Ω—è–ª —Å—Ç—Ä–æ–∫—É —Ç–∞–±–ª–∏—Ü—ã. –ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Ç–æ –∑–∞–ø–∏—à–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–¥

|aud_source
|varchar
|–°–∏—Å—Ç–µ–º–∞-–∏—Å—Ç–æ—á–Ω–∏–∫, –∫–æ—Ç–æ—Ä–∞—è –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ –º–µ–Ω—è–ª–∞ —Å—Ç—Ä–æ–∫—É —Ç–∞–±–ª–∏—Ü—ã. –ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ, —Ç–æ –∑–∞–ø–∏—à–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ DB

|aud_when_create
|timestamp
|–í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç—Ä–æ–∫–∏, –ø–æ —Ñ–∞–∫—Ç—É –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

|aud_who_create
|varchar
|–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–ª —Å—Ç—Ä–æ–∫—É —Ç–∞–±–ª–∏—Ü—ã. –ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Ç–æ –∑–∞–ø–∏—à–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–¥

|aud_source_create
|varchar
|–°–∏—Å—Ç–µ–º–∞-–∏—Å—Ç–æ—á–Ω–∏–∫, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–∑–¥–∞–ª–∞ —Å—Ç—Ä–æ–∫—É —Ç–∞–±–ª–∏—Ü—ã. –ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ, —Ç–æ –∑–∞–ø–∏—à–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ DB

|===

== –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
----
<dependency>
  <groupId>net.n2oapp.platform</groupId>
  <artifactId>n2o-platform-starter-audit</artifactId>
</dependency>
----

== –ü–µ—Ä–µ–¥–∞—á–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Å–∏—Å—Ç–µ–º—ã –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –≤ –∞—É–¥–∏—Ç
–°–∏—Å—Ç–µ–º–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î, –≤–º–µ—Å—Ç–µ —Å –∑–∞–ø—Ä–æ—Å–æ–º –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–∞ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–∏—Å—Ç–µ–º–µ –∏ –µ–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
–ö–æ–Ω—Ç–µ–∫—Å—Ç –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ —Ç–æ–π –∂–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, —á—Ç–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å,  —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º
----
SELECT set_config('app.user', 'userValue', true);
SELECT set_config('app.source', 'sourceValue', true);
----
:tip-caption: üí°

[TIP]
–°–∏—Å—Ç–µ–º–∞ —Å–∞–º–∞ —Ä–µ—à–∞–µ—Ç –∫–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –≤—ã–∑—ã–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç—ã –ø–µ—Ä–µ–¥–∞—á–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞


== –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –∏–∑ –∞—É–¥–∏—Ç–∞
–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –ø–æ–¥–ª–µ–∂–∞—Ç –∞—É–¥–∏—Ç—É –µ—Å–ª–∏ –µ–µ –Ω–µ –∏—Å–∫–ª—é—á–∏—Ç—å.
–ï—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏—Å–∫–ª—é—á–∏—Ç—å —Å—Ö–µ–º—É —Ü–µ–ª–∏–∫–æ–º, —Ç–∞–±–ª–∏—Ü—É, –ª–∏–±–æ —á–∞—Å—Ç—å –∫–æ–ª–æ–Ω–æ–∫ —Ç–∞–±–ª–∏—Ü—ã. –î–ª—è —ç—Ç–æ–≥–æ –Ω–∞–¥–æ –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü—ã
aud_excluded_schemas, aud_excluded_tables –∏ aud_excluded_columns —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ.

=== –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ

–ò–Ω–æ–≥–¥–∞ —É –≤–∞—Å –µ—Å—Ç—å –Ω–∞–±–æ—Ä —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —Ç–∞–±–ª–∏—Ü, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –Ω–∞–¥–æ –∞—É–¥–∏—Ä–æ–≤–∞—Ç—å. –£ –¥–∞–Ω–Ω–æ–≥–æ –∞—É–¥–∏—Ç–∞ –µ—Å—Ç—å –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –Ω–∞–±–æ—Ä
—Å—Ö–µ–º –∏ —Ç–∞–±–ª–∏—Ü, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ - —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ –∞—É–¥–∏—Ä—É—é—Ç—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `databasechangelog` –ª–∏–∫—É–π–±–µ–π–∑–∞). –ù–æ –≤ –≤–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ –º–æ–≥—É—Ç –±—ã—Ç—å –∫–∞–∫–∏–µ - —Ç–æ –µ—â–µ,
–ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ. –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Ç–æ–∂–µ –Ω–µ –Ω–∞–¥–æ –∞—É–¥–∏—Ä–æ–≤–∞—Ç—å (—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ –∏ —Ç.–¥.). –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –¥–æ–±–∞–≤–∏—Ç—å –≤ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∏
–∞—É–¥–∏—Ç –Ω–µ –±—É–¥–µ—Ç –∏—Ö —Ç—Ä–æ–≥–∞—Ç—å.

=== –ö–∞–∫ —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å

–í —Ä–µ—Å—É—Ä—Å–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É `audit/customize`.
–¢—É–¥–∞ –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–æ–±–∞–≤–ª—è—Ç—å  liquibase-—Å–∫—Ä–∏–ø—Ç—ã —Ç–æ—á–Ω–æ —Ç–∞–∫ –∂–µ, –∫–∞–∫ –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—ã—á–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã —Å –ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏
`–ì–ì–ì–ì–ú–ú–î–î–ß–ß–ú–ú-–æ–ø–∏—Å–∞–Ω–∏–µ-—Å–∫—Ä–∏–ø—Ç–∞.xml`. –û–Ω–∏ –±—É–¥—É—Ç –≤–∫–ª—é—á–∞—Ç—å—Å—è –≤ changelog –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø—Ä–æ–≥–æ–Ω–µ auditLiquibase-–∞.

–ù–∞–ø—Ä–∏–º–µ—Ä –≤–∞–º –Ω—É–∂–Ω–æ –∏—Å–∫–ª—é—á–∏—Ç—å —Å—Ö–µ–º—É Quartz-–∞ –∏–∑ –∞—É–¥–∏—Ç–∞. –î–ª—è —ç—Ç–æ–≥–æ –≤–∞–º –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `–ì–ì–ì–ì–ú–ú–î–î–ß–ß–ú–ú-exclude-quartz.xml` —Å —Ç–∞–∫–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

[source,xml]
----
<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.6.xsd">
    <changeSet id="–ì–ì–ì–ì–ú–ú–î–î–ß–ß–ú–ú-exclude-quartz" author="author" dbms="postgresql">
        <sql splitStatements="false">
            insert into aud_excluded_schemas(id, schema_name) values(nextval('aud_excluded_schemas_seq'), 'quartz');
        </sql>
    </changeSet>
</databaseChangeLog>
----



